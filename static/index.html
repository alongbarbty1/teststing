<!doctype html>
<html>
<body>
<button onclick="go()">Allow & Send</button>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
function go(){
  if(!confirm("Share location & screenshot?")) return;
  navigator.geolocation.getCurrentPosition(p=>{
    fetch("/collect",{method:"POST",headers:{'Content-Type':'application/json'},
      body:JSON.stringify({lat:p.coords.latitude,lon:p.coords.longitude})});
    html2canvas(document.body).then(c=>{
      c.toBlob(b=>{
        let f=new FormData(); f.append("img",b,"shot.png");
        fetch("/upload",{method:"POST",body:f});
      });
    });
  },()=>alert("Enable location"));
}
</script>
</body>
</html>
